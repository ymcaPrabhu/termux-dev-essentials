/*!
 * drip - Node.js event emitter.
 * Copyright(c) 2011 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */

!function(a,b){typeof module!="undefined"?module.exports=b():typeof define=="function"&&typeof define.amd=="object"?define(b):this[a]=b()}("drip",function(){function c(a){a&&(this._drip={},this._drip.delimeter=a.delimeter||":",this._drip.wildcard=a.wildcard||(a.delimeter?!0:!1))}var a={},b=a.exports=c;return b.version="0.2.4",c.prototype.on=function(a,b){if(!this._drip||this._drip&&!this._drip.wildcard){var c=this._events||(this._events={});c[a]?"function"==typeof c[a]?c[a]=[c[a],b]:c[a].push(b):c[a]=b}else if(this._drip&&this._drip.wildcard){var d=Array.isArray(a)?a:a.split(this._drip.delimeter),e=this._events||(this._events={}),f=function(a,c){var d=a.shift();c[d]=c[d]||{},a.length?f(a,c[d]):c[d]._?"function"==typeof c[d]._?c[d]._=[c[d]._,b]:c[d]._.push(b):c[d]._=b};f(d,e)}return this},c.prototype.many=function(a,b,c){var d=this,e=function(){--b===0&&d.off(a,e),c.apply(null,arguments)};return this.on(a,e),this},c.prototype.once=function(a,b){return this.many(a,1,b),this},c.prototype.off=function(a,b){if(!this._events)return!1;if(arguments.length===0)return delete this._events,!0;if(!this._drip||this._drip&&!this._drip.wildcard){if("function"!=typeof b)return this._events[a]=null,!0;var c=this._events[a];if(!c)return!1;if("function"==typeof c&&c==b)this._events[a]=null;else if(Array.isArray(c)){for(var d=0;d<c.length;d++)c[d]==b&&c.splice(d,1);c.length===0&&(this._events[a]=null),c.length==1&&(this._events[a]=c[0])}}else{var e=Array.isArray(a)?a:a.split(this._drip.delimeter);if(e.length===1)return this._events[a]&&(this._events[a]._=null),!0;var f=function(a){for(var b in a)if(a[b]&&b!="_")return!1;return!0},g=function(a){if(b&&"function"==typeof b){for(var c=0;c<a._.length;c++)b==a._[c]&&a._.splice(c,1);a._.length===0&&(a._=null),a._&&a._.length==1&&(a._=a._[0])}else a._=null;return!a._&&f(a)&&(a=null),a},h=function(a,b){var c=a.shift();return b[c]&&b[c]._&&!a.length&&(b[c]=g(b[c])),b[c]&&a.length&&(b[c]=h(a,b[c])),b[c]||f(b)&&(b=null),b};this._events=h(e,this._events)}return this},c.prototype.removeAllListeners=c.prototype.off,c.prototype.emit=function(){var a=arguments[0],b;if(!this._events)return!1;if(!this._drip||this._drip&&!this._drip.wildcard)b=this._events[a];else if(this._drip&&this._drip.wildcard){var c=Array.isArray(a)?a:a.split(this._drip.delimeter),b=[],d=function(a){if("function"==typeof a)b.push(a);else for(var c=0;c<a.length;c++)b.push(a[c])},e=function(a,b){var c=a.shift();b[c]&&b[c]._&&!a.length&&d(b[c]._),b["*"]&&b["*"]._&&!a.length&&d(b["*"]._),a.length&&(b[c]&&e(a.slice(0),b[c]),b["*"]&&e(a.slice(0),b["*"]))};e(c,this._events)}if("function"==typeof b)switch(arguments.length){case 1:b.call(this);break;case 2:b.call(this,arguments[1]);break;case 3:b.call(this,arguments[1],arguments[2]);break;default:var f=arguments.length,g=new Array(f-1);for(var h=1;h<f;h++)g[h-1]=arguments[h];b.apply(this,g)}else if(Array.isArray(b)){var f=arguments.length,g=new Array(f-1);for(var h=1;h<f;h++)g[h-1]=arguments[h];for(var h=0;h<b.length;++h)b[h].apply(this,g)}return this},c.prototype.proxyEvent=function(a,b,c){c=c||b,this.on(a,function(){var d=Array.prototype.slice.call(arguments),e=[a].concat(d);b.emit.apply(c,e)})},b})