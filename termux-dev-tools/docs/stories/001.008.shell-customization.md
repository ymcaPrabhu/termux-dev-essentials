# Story 1.8: Shell Customization

## Status
- Approved

## Story
**As a** developer,
**I want** the installer to safely apply helpful aliases and a custom shell prompt,
**so that** my shell is more informative and user-friendly for development tasks.

## Acceptance Criteria
1. The script must define a default set of useful shell aliases (e.g., `ll` for `ls -la`).
2. The script must define a default, informative `PS1` prompt that may include git branch status.
3. The script must prompt the user if they want to apply these customizations.
4. If the user agrees, the script must idempotently add the aliases and `PS1` configuration to the user's `.bashrc` or `.zshrc`.
5. The script must ensure that a backup of the user's original shell configuration was created (as per Story 1.1).

## Tasks / Subtasks
- [ ] **Task 1: Define Customizations (AC: #1, #2)**
    - [ ] Create a separate file (`assets/shell-customizations.sh`) that contains the alias definitions and `PS1` export.
- [ ] **Task 2: User Prompt (AC: #3)**
    - [ ] Use `read -p` to ask the user for confirmation before applying the changes.
- [ ] **Task 3: Apply Customizations (AC: #4)**
    - [ ] If the user confirms, `source` or append the `shell-customizations.sh` file from the user's `.bashrc` or `.zshrc`.
    - [ ] The append logic must be idempotent, checking if the line already exists.
- [ ] **Task 4: Verify Backup (AC: #5)**
    - [ ] Add a check to ensure the `.bak` file from Story 1.1 exists before proceeding.

## Dev Notes
- **Source Tree**: The customizations themselves should be in a well-defined asset file. The logic to apply them will be in a script like `scripts/apply-shell-config.sh`.
- **Separation of Concerns**: Keeping the aliases and `PS1` in a separate file makes them easier to manage and customize.
- **Idempotency**: A common pattern is to add a comment marker and check for that marker before appending the `source` line to the user's rc file. For example:
  `# BEGIN BMad Shell Customizations
source ~/path/to/customizations.sh
# END BMad Shell Customizations`

### Testing
- **Test File Location**: `tests/test-apply-shell-config.sh`
- **Test Standards**: Testing will involve creating dummy `.bashrc` and `.zshrc` files and checking their contents after the script runs.
- **Requirements**:
    - Test the case where the user accepts the customizations.
    - Test the case where the user declines the customizations.
    - Test that the script correctly identifies the right rc file (`.bashrc` vs `.zshrc`).
    - Test that re-running the script does not add duplicate entries.

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-10-11 | 1.0 | Initial draft | Sarah (PO) |
