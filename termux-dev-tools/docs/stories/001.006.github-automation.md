# Story 1.6: GitHub Automation

## Status
- Approved

## Story
**As a** developer,
**I want** the installer to automate my GitHub setup, including SSH keys and `git` configuration,
**so that** I can securely and immediately interact with my remote repositories.

## Acceptance Criteria
1. The script must check for the existence of a default SSH key pair (e.g., `~/.ssh/id_ed25519`).
2. If no SSH key is found, the script must generate a new one (`ssh-keygen`) without a passphrase for automation purposes.
3. The script must display the public SSH key to the user and provide clear instructions on how to add it to their GitHub account.
4. After the user confirms they have added the key, the script must verify the authentication by running `ssh -T git@github.com`.
5. The script must prompt the user for their Git name and email and configure them globally using `git config --global`.
6. The entire process must be idempotent; re-running the script should not overwrite existing keys or configs without confirmation.

## Tasks / Subtasks
- [ ] **Task 1: Check for Existing SSH Key (AC: #1, #6)**
    - [ ] Check if `~/.ssh/id_ed25519` or `~/.ssh/id_rsa` exists.
    - [ ] If a key exists, inform the user and skip generation.
- [ ] **Task 2: Generate SSH Key (AC: #2)**
    - [ ] If no key exists, run `ssh-keygen` with non-interactive options (e.g., `ssh-keygen -t ed25519 -C "your_email@example.com" -N ''`).
- [ ] **Task 3: User Interaction for Key Upload (AC: #3)**
    - [ ] `cat` the public key file to the console.
    - [ ] Display a URL to the GitHub SSH keys settings page.
    - [ ] Pause the script and wait for user confirmation before proceeding.
- [ ] **Task 4: Verify SSH Connection (AC: #4)**
    - [ ] Execute `ssh -T git@github.com`.
    - [ ] The script needs to handle the initial connection prompt and check the command's output for a success message.
- [ ] **Task 5: Configure Git (AC: #5)**
    - [ ] Use `read -p` to prompt the user for their name and email.
    - [ ] Execute `git config --global user.name "..."` and `git config --global user.email "..."`.

## Dev Notes
- **Source Tree**: This logic should be in its own script, `scripts/setup-github.js` or `scripts/setup-github.sh`.
- **Security**: This story involves sensitive user credentials (SSH keys). The script must be transparent about what it's doing. Generating keys without a passphrase is a trade-off for convenience; this should be noted.
- **Authentication Method**: The brief mentioned device code or PAT auth as an alternative. This story focuses on the more traditional SSH key method, which is often preferred for CLI git operations. Other methods could be added in a future story.

### Testing
- **Test File Location**: `tests/test-setup-github.sh`
- **Test Standards**: Testing will involve mocking `ssh-keygen`, `git`, and user input.
- **Requirements**:
    - Test the path where no SSH key exists.
    - Test the path where an SSH key already exists.
    - Test that user input for git config is correctly applied.
    - Mock the `ssh -T` command to test both success and failure of authentication.

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-10-11 | 1.0 | Initial draft | Sarah (PO) |
