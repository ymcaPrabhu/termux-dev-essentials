# Story 1.4: CLI Suite Installation

## Status
- Approved

## Story
**As a** developer,
**I want** the installer to install my required suite of CLI development tools,
**so that** I can perform my development tasks efficiently.

## Acceptance Criteria
1. The script must define a list of required CLI tools to be installed (e.g., `cloud-code`, `gemini-cli`, `codec-cli`, `open-core-cli`, `factory-ai`, `droid-cli`).
2. For each tool, the script must first attempt to install it natively in the Termux environment (e.g., using `npm install -g` or other appropriate package managers).
3. If a native installation command fails, the script must log the failure and trigger the `proot-distro` fallback mechanism.
4. As part of the fallback, the script will attempt to install the failed tool inside the Ubuntu proot environment.
5. The script must verify the successful installation of each tool by checking for its command availability, either natively or within the proot.
6. The entire process must be idempotent; re-running the script should not cause errors or re-install already present tools.

## Tasks / Subtasks
- [ ] **Task 1: Define CLI Tool List (AC: #1)**
    - [ ] Create a configuration (e.g., an array in the script) listing the CLIs and their installation commands.
- [ ] **Task 2: Native Installation Loop (AC: #2, #6)**
    - [ ] Loop through the list of CLI tools.
    - [ ] Check if the tool is already installed natively.
    - [ ] If not, execute the native installation command.
- [ ] **Task 3: Fallback Logic (AC: #3, #4)**
    - [ ] Wrap the native installation command in an `if` block to check its exit code.
    - [ ] If the exit code is non-zero, call the proot installation script/function, passing the tool's information.
    - [ ] The proot installation logic should run inside the Ubuntu container (`proot-distro login ubuntu -- ...`).
- [ ] **Task 4: Verification (AC: #5)**
    - [ ] After each installation attempt (native or proot), verify the tool is available.
    - [ ] For proot installs, this may involve checking inside the container.

## Dev Notes
- **Source Tree**: This logic will likely reside in `scripts/install-cli-suite.js` (as a Node.js script might be better for managing the complex logic and external commands).
- **Dependency**: This story is critically dependent on Story 1.3 (`setup-proot.sh`) and Story 1.5 (`generate-shims.js`). The decision logic is here, but the fallback environment and the shims to make it seamless are separate.
- **Error Handling**: Robust error handling is key. The script needs to distinguish between a tool that is already installed and a tool that failed to install.

### Testing
- **Test File Location**: `tests/test-install-cli-suite.js`
- **Test Standards**: Use a testing framework like Jest or Mocha to test the installation logic.
- **Requirements**:
    - Mock the installation commands to test the logic without actual installations.
    - Test the success path where a tool installs natively.
    - Test the fallback path where a native install fails and the proot install is triggered.
    - Test idempotency by mocking a tool as already installed.

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-10-11 | 1.0 | Initial draft | Sarah (PO) |
