# Story 3.1: Correct CLI Tools List with Verified Packages

## Status
- Ready for Review

## Story
**As a** developer or user,  
**I want** the CLI tools list updated with real, verified npm packages,  
**so that** installations succeed and I can use AI coding assistants.

## Acceptance Criteria
1. All CLI tool package names must be verified to exist on npm registry
2. Package install commands must use correct package names
3. Verify commands must use correct CLI command names
4. Factory Droid must use curl installer (not npm)
5. Non-existent `droid-cli` must be removed from list
6. All 4 npm packages must install successfully on test system
7. Tests must pass with 100% success rate
8. Documentation must reflect corrected package names

## Background & Problem

### Current State
The `scripts/install-cli-suite.js` contains 6 CLI tools:
```javascript
const CLI_TOOLS = [
  { name: 'cloud-code', installCmd: 'npm install -g @google-cloud/cloud-code', verifyCmd: 'cloud-code --version' },
  { name: 'gemini-cli', installCmd: 'npm install -g @google/generative-ai-cli', verifyCmd: 'gemini --version' },
  { name: 'codec-cli', installCmd: 'npm install -g codec-cli', verifyCmd: 'codec --version' },
  { name: 'open-core-cli', installCmd: 'npm install -g open-core-cli', verifyCmd: 'open-core --version' },
  { name: 'factory-ai', installCmd: 'npm install -g @factory-ai/cli', verifyCmd: 'factory-ai --version' },
  { name: 'droid-cli', installCmd: 'npm install -g droid-cli', verifyCmd: 'droid --version' },
];
```

### Problems Identified
1. ‚ùå `@google-cloud/cloud-code` - Does not exist
2. ‚ùå `@google/generative-ai-cli` - Wrong name (should be `@google/gemini-cli`)
3. ‚ùå `codec-cli` - Does not exist (should be `@openai/codex`)
4. ‚ùå `open-core-cli` - Does not exist (should be `opencode-ai`)
5. ‚ùå `@factory-ai/cli` - Not on npm (requires curl installer)
6. ‚ö†Ô∏è `droid-cli` - Wrong tool (Android dev, not Factory.ai)

**Impact**: 100% installation failure rate

### Research Findings
Web research and npm verification confirmed:
- **@anthropic-ai/claude-code** ‚úÖ (5.2M weekly downloads)
- **@google/gemini-cli** ‚úÖ (corrected name)
- **@openai/codex** ‚úÖ (corrected name)
- **opencode-ai** ‚úÖ (open source alternative)
- **Factory Droid** ‚úÖ (curl installer only)

## Tasks / Subtasks

- [x] **Task 1: Update CLI_TOOLS Array** (AC: #1, #2, #3)
    - [x] Replace `@google-cloud/cloud-code` with `@anthropic-ai/claude-code`
    - [x] Correct `@google/generative-ai-cli` to `@google/gemini-cli`
    - [x] Replace `codec-cli` with `@openai/codex`
    - [x] Replace `open-core-cli` with `opencode-ai`
    - [x] Update all verify commands with correct CLI names

- [x] **Task 2: Add Factory Droid Special Handler** (AC: #4)
    - [x] Create `SPECIAL_INSTALLERS` array for non-npm tools
    - [x] Implement `installViaCurl()` function for curl installers
    - [x] Add Factory Droid with curl install command
    - [x] Verify installation after curl execution

- [x] **Task 3: Remove Incorrect droid-cli** (AC: #5)
    - [x] Remove `droid-cli` from CLI_TOOLS array
    - [x] Update comments to clarify Factory Droid vs Android droid-cli
    - [x] Add warning in documentation

- [x] **Task 4: Add API Key Metadata** (Preparation for Story 3.2)
    - [x] Add `requiresApiKey: true` flag to each tool
    - [x] Add `apiKeyVar` field with environment variable name
    - [x] Add `description` field with tool purpose

- [x] **Task 5: Update Tests** (AC: #7)
    - [x] Update test expectations for new package names
    - [x] Add tests for Factory Droid special installer
    - [x] Test installation success on test system
    - [x] Verify all 4 npm packages install correctly

- [x] **Task 6: Update Documentation** (AC: #8)
    - [x] Update README.md with correct package names
    - [x] Update install-cli-suite.js JSDoc comments
    - [x] Add CLI-CORRECTIONS.md reference
    - [x] Update menu descriptions if applicable

## Proposed Solution

### New CLI_TOOLS Array
```javascript
const CLI_TOOLS = [
  {
    name: 'claude-code',
    installCmd: 'npm install -g @anthropic-ai/claude-code',
    verifyCmd: 'claude --version',
    description: 'Anthropic Claude Code - Agentic coding assistant',
    requiresApiKey: true,
    apiKeyVar: 'ANTHROPIC_API_KEY',
  },
  {
    name: 'gemini-cli',
    installCmd: 'npm install -g @google/gemini-cli',
    verifyCmd: 'gemini --version',
    description: 'Google Gemini CLI - Terminal AI assistant',
    requiresApiKey: true,
    apiKeyVar: 'GOOGLE_API_KEY',
  },
  {
    name: 'codex',
    installCmd: 'npm install -g @openai/codex',
    verifyCmd: 'codex --version',
    description: 'OpenAI Codex - AI coding agent',
    requiresApiKey: true,
    apiKeyVar: 'OPENAI_API_KEY',
  },
  {
    name: 'opencode',
    installCmd: 'npm install -g opencode-ai',
    verifyCmd: 'opencode --version',
    description: 'OpenCode AI - Open source coding agent',
    requiresApiKey: true,
    apiKeyVar: 'OPENAI_API_KEY',
  },
];

const SPECIAL_INSTALLERS = [
  {
    name: 'droid',
    installCmd: 'curl -fsSL https://static.factory.ai/droid/install.sh | sh',
    verifyCmd: 'droid --version',
    description: 'Factory Droid - AI development agent',
    requiresApiKey: true,
    apiKeyVar: 'FACTORY_API_KEY',
    installMethod: 'curl',
  },
];
```

### New Helper Functions
```javascript
/**
 * Install tool via curl script
 */
function installViaCurl(tool) {
  console.log(`\nüîÑ Installing ${tool.name} via curl...`);
  
  try {
    execSync(tool.installCmd, {
      stdio: 'inherit',
      encoding: 'utf8',
    });
    
    if (commandExists(tool.verifyCmd)) {
      console.log(`‚úÖ Successfully installed '${tool.name}'.`);
      return true;
    }
  } catch (error) {
    console.log(`‚ùå Curl installation failed for '${tool.name}'.`);
    return false;
  }
  return false;
}
```

## Dev Notes

### Package Verification Sources
- **NPM Registry**: https://www.npmjs.com/package/[package-name]
- **Anthropic Claude Code**: https://www.npmjs.com/package/@anthropic-ai/claude-code (v1.0.117)
- **Google Gemini CLI**: https://www.npmjs.com/package/@google/gemini-cli
- **OpenAI Codex**: https://www.npmjs.com/package/@openai/codex
- **OpenCode AI**: https://www.npmjs.com/package/opencode-ai
- **Factory Droid**: https://docs.factory.ai/cli/getting-started/overview

### API Key Requirements
All tools require API keys:
- **Claude Code**: ANTHROPIC_API_KEY
- **Gemini CLI**: GOOGLE_API_KEY (free tier available)
- **Codex**: OPENAI_API_KEY
- **OpenCode**: Supports multiple providers
- **Droid**: FACTORY_API_KEY

### Testing Approach
1. **Unit Tests**: Verify package names exist
2. **Integration Tests**: Test actual npm installs
3. **Manual Tests**: Test on Termux, Linux, macOS

## Component Descriptions

### 1. Anthropic Claude Code
- **Purpose**: Agentic coding assistant for terminal
- **Features**: Code editing, Git workflows, task automation
- **Downloads**: 5.2M weekly
- **Command**: `claude`
- **Free Tier**: No (requires paid API key)

### 2. Google Gemini CLI
- **Purpose**: Terminal-based AI assistant
- **Features**: Code generation, automation, Google Search grounding
- **Downloads**: Verified on npm
- **Command**: `gemini`
- **Free Tier**: Yes (generous limits)

### 3. OpenAI Codex
- **Purpose**: AI coding agent from OpenAI
- **Features**: Code understanding, refactoring, multi-step tasks
- **Downloads**: Verified on npm
- **Command**: `codex`
- **Free Tier**: No (requires paid API key)

### 4. OpenCode AI
- **Purpose**: Open source coding agent
- **Features**: Multiple LLM providers, native terminal UI
- **Downloads**: Verified on npm
- **Command**: `opencode`
- **Free Tier**: Depends on provider

### 5. Factory Droid
- **Purpose**: AI development agent
- **Features**: End-to-end development, CI/CD integration
- **Installation**: curl installer only
- **Command**: `droid`
- **Free Tier**: Limited (check factory.ai pricing)

## Testing

### Test File Location
`tests/test-cli-suite-corrected.js`

### Test Requirements
- Verify all package names exist on npm
- Test installation commands
- Verify CLI commands work after install
- Test Factory Droid curl installer
- Ensure API key warnings display

### Expected Results
- ‚úÖ 100% package verification success
- ‚úÖ 4/4 npm packages install successfully
- ‚úÖ Factory Droid installs via curl
- ‚úÖ All verify commands return version info

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-01-11 | 1.0 | Initial story draft | Droid (Analysis) |
| 2025-01-11 | 1.1 | Story approved for development | Bob (SM) |
| 2025-01-11 | 2.0 | Implementation complete, all tasks done | James (Dev) |

## Dev Agent Record

### Agent Model Used
- Claude 3.7 Sonnet (Developer - James)

### File List
- `scripts/install-cli-suite.js` (MODIFIED - Updated CLI_TOOLS array, added SPECIAL_INSTALLERS, added installViaCurl())
- `tests/test-cli-suite-corrected.js` (CREATED - 55 tests, all passing)
- `README.md` (MODIFIED - Updated CLI tool documentation with correct packages and API key requirements)
- `docs/CLI-CORRECTIONS.md` (REFERENCE - Detailed research and corrections)

### Completion Notes
- Replaced 6 incorrect/non-existent packages with 4 verified npm packages + 1 curl installer
- All package names verified against npm registry
- Added comprehensive metadata (API keys, descriptions)
- Created 55 tests - 100% pass rate
- Factory Droid implemented as special curl-based installer
- Updated documentation with API key requirements
- All acceptance criteria met

### Implementation Approach
1. ‚úÖ Updated CLI_TOOLS array with 4 verified npm packages
2. ‚úÖ Created SPECIAL_INSTALLERS array for curl-based tools (Factory Droid)
3. ‚úÖ Implemented installViaCurl() function
4. ‚úÖ Updated main installation orchestrator to handle both npm and curl installers
5. ‚úÖ Added API key metadata to all tools
6. ‚úÖ Created comprehensive test suite (55 tests)
7. ‚úÖ Updated README.md documentation

## QA Results

_Pending implementation and QA review_

---

## Related Documents
- [Epic 003: CLI Tools Correction](./epic-003-cli-tools-correction.md)
- [CLI Corrections Reference](../CLI-CORRECTIONS.md)
- [Story 3.2: API Key Configuration](./003.002.api-key-config.md) (Coming next)

---

**Priority**: CRITICAL  
**Effort**: 2 hours  
**Business Value**: HIGH - Fixes 100% installation failure rate
