# Story 1.2: Prerequisite Installation

## Status
- Approved

## Story
**As a** developer,
**I want** the installer to idempotently install all necessary prerequisite tools,
**so that** the main application and CLI tools can be installed and run correctly.

## Acceptance Criteria
1. The script must check for the presence of the following tools: `nodejs`, `npm`, `git`, `openssh`, `curl`, and `python`.
2. For each tool in the list, if it is not found, the script must attempt to install it using `pkg install -y`.
3. For each tool in the list, if it is already installed, the script must report it and skip the installation.
4. The script must verify the successful installation of each new package by checking its version or presence in the path.
5. The entire process must be idempotent, meaning running the script multiple times does not cause errors or unintended side effects.
6. The script must output clear logs indicating which packages are being checked, which are being installed, and which are already present.

## Tasks / Subtasks
- [x] **Task 1: Create Prerequisite List (AC: #1)**
    - [x] Define an array or list of required packages.
- [x] **Task 2: Loop and Check (AC: #1, #3)**
    - [x] Implement a loop that iterates through the prerequisite list.
    - [x] For each package, use a command like `command -v` to check if it exists.
- [x] **Task 3: Installation Logic (AC: #2)**
    - [x] If a command does not exist, call `pkg install -y [package_name]`.
- [x] **Task 4: Verification (AC: #4)**
    - [x] After an installation attempt, re-run the check to verify success.
    - [x] Log an error if a package fails to install.
- [x] **Task 5: Logging (AC: #6)**
    - [x] Add `echo` statements to provide clear, step-by-step feedback to the user.

## Dev Notes
- **Source Tree**: This story will likely be implemented in a new script, e.g., `scripts/install-prereqs.sh`.
- **Idempotency**: The core of this story is idempotency. The `command -v` check before any `pkg install` call is critical.
- **Error Handling**: The script should handle the case where `pkg install` fails (e.g., due to network issues) and exit gracefully.

### Testing
- **Test File Location**: `tests/test-install-prereqs.sh`
- **Test Standards**: Use a series of shell commands to test the script's behavior.
- **Requirements**:
    - Test on a system where a prerequisite is missing.
    - Test on a system where all prerequisites are already present.
    - Test that the script correctly identifies both missing and existing packages in a single run.
    - Test that a failure in `pkg install` is handled correctly.

## Dev Agent Record

### File List
- `scripts/install-prereqs.sh`
- `tests/test-install-prereqs.sh`

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-10-11 | 1.0 | Initial draft | Sarah (PO) |
| 2025-10-11 | 1.1 | MVP implementation complete | James (dev) |
