# Story 1.5: Command Shim Generation

## Status
- Approved

## Story
**As a** developer,
**I want** a seamless command shim created for any tool installed in the Ubuntu fallback environment,
**so that** I can call the tool directly from my main Termux shell without any extra steps.

## Acceptance Criteria
1. For each CLI tool installed within the Ubuntu proot, a corresponding wrapper script (shim) must be created in a Termux binary directory (e.g., `$PREFIX/bin`).
2. The generated shim script must be executable (`chmod +x`).
3. When the shim script is executed from the Termux shell, it must use `proot-distro login ubuntu -- [command]` to run the tool inside the container.
4. All command-line arguments, flags, and parameters passed to the shim script must be transparently and accurately passed to the target command inside the proot.
5. The `stdout`, `stderr`, and exit code from the command running inside the proot must be correctly propagated back to the calling Termux shell.

## Tasks / Subtasks
- [ ] **Task 1: Shim Generation Function (AC: #1)**
    - [ ] Create a function or script that takes a command name as input.
    - [ ] This function will generate the text of the shell script shim.
- [ ] **Task 2: Shim Script Content (AC: #3, #4, #5)**
    - [ ] The script content should be a template like: `#!/data/data/com.termux/files/usr/bin/sh
proot-distro login ubuntu -- [command_name] "$@"`.
    - [ ] Ensure `"$@"` is used to correctly handle arguments with spaces.
- [ ] **Task 3: File Creation and Permissions (AC: #1, #2)**
    - [ ] Write the generated script content to a file in `$PREFIX/bin/`.
    - [ ] Set the file to be executable using `chmod +x`.
- [ ] **Task 4: Integration with CLI Installer (AC: #1)**
    - [ ] The CLI installation script (from Story 1.4) must call this shim generation function whenever it successfully installs a tool in the proot environment.

## Dev Notes
- **Source Tree**: This could be a standalone script `scripts/generate-shims.js` or a function within the main `install-cli-suite.js` script.
- **Core Logic**: The key is the `proot-distro login [distro] -- [command] "$@"` pattern. This is the heart of the seamless integration.
- **PATH**: The shims must be placed in a directory that is part of the user's `$PATH` in Termux. `$PREFIX/bin` is the standard location for this.

### Testing
- **Test File Location**: `tests/test-generate-shims.js`
- **Test Standards**: Tests should focus on the script generation logic.
- **Requirements**:
    - Test that the generated script content is correct for a given command name.
    - Test that the script is created in the correct location.
    - Test that the script is made executable.
    - An integration test would involve creating a fake proot command and a shim, then running the shim from Termux to see if the fake command is executed with the correct arguments.

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-10-11 | 1.0 | Initial draft | Sarah (PO) |
