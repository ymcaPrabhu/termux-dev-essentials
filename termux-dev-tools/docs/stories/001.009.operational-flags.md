# Story 1.9: Operational Flags

## Status
- Approved

## Story
**As a** developer running the installer,
**I want** to use operational flags like `--dry-run` and `--verbose`,
**so that** I can understand, test, and debug the installation process without making actual changes or by getting more detailed output.

## Acceptance Criteria
1. The main installer script must correctly parse `--dry-run` and `--verbose` command-line arguments.
2. When the `--dry-run` flag is provided, the script must print the shell commands it would execute (e.g., `pkg install`, `git clone`) instead of actually executing them.
3. When the `--dry-run` flag is provided, no changes must be made to the filesystem or system state.
4. When the `--verbose` flag is provided, the script must output additional, detailed logging for debugging purposes.
5. The two flags must be able to be used in combination.

## Tasks / Subtasks
- [ ] **Task 1: Argument Parsing (AC: #1)**
    - [ ] Implement argument parsing at the beginning of the main script to detect the flags.
- [ ] **Task 2: `dry-run` Logic (AC: #2, #3)**
    - [ ] Create a wrapper function, e.g., `execute_command()`.
    - [ ] In normal mode, this function runs the command.
    - [ ] In dry-run mode, this function `echo`s the command instead of running it.
    - [ ] Refactor all commands throughout the scripts to use this wrapper function.
- [ ] **Task 3: `verbose` Logic (AC: #4)**
    - [ ] Create a logging function, e.g., `log_verbose()`.
    - [ ] This function checks if the verbose flag is set before printing a message.
    - [ ] Sprinkle `log_verbose()` calls at key points in the scripts to provide extra context.

## Dev Notes
- **Source Tree**: This will affect the main entry point of the installer and will require creating shared utility functions that all other scripts can use.
- **Implementation**: A good way to handle this is to set global environment variables (e.g., `DRY_RUN=true`, `VERBOSE=true`) at the start, which all subsequent scripts and functions can read.
- **Wrapper Function**: The `execute_command` wrapper is the cleanest way to implement the dry-run functionality. It centralizes the logic and avoids cluttering the main scripts with `if/else` statements for every command.

### Testing
- **Test File Location**: `tests/test-operational-flags.sh`
- **Test Standards**: Test the argument parsing and the behavior of the wrapper functions.
- **Requirements**:
    - Run the main script with `--dry-run` and capture the output. Verify that the output contains the commands that *should* have been run.
    - Run the main script with `--dry-run` and verify that no actual changes were made (e.g., no files were created).
    - Run with `--verbose` and check that the output contains the expected verbose log messages.

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-10-11 | 1.0 | Initial draft | Sarah (PO) |
