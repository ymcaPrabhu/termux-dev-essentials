# Story 1.3: Proot-Distro & Ubuntu Bootstrap

## Status
- Approved

## Story
**As a** developer who needs tools not natively compatible with Termux,
**I want** the installer to automatically set up a `proot-distro` Ubuntu instance as a fallback environment,
**so that** I can run a wider range of development tools seamlessly.

## Acceptance Criteria
1. The script must check if `proot-distro` is installed via `pkg`. If not, it must be installed.
2. The script must check if an Ubuntu distribution has already been installed by `proot-distro`.
3. If an Ubuntu distribution is not found, the script must execute `proot-distro install ubuntu` to create it.
4. If an Ubuntu distribution is already present, the script must report it and skip the installation step.
5. The script must verify that the Ubuntu instance is accessible (e.g., by running a simple command like `proot-distro login ubuntu -- echo 'Success'`).
6. The entire setup process must be idempotent.

## Tasks / Subtasks
- [x] **Task 1: Check/Install `proot-distro` (AC: #1)**
    - [x] Use `command -v proot-distro` to check for existence.
    - [x] If it doesn't exist, install it using `pkg install proot-distro -y`.
- [x] **Task 2: Check for Existing Ubuntu Instance (AC: #2, #4)**
    - [x] Use `proot-distro list` and `grep` to check if 'ubuntu' is in the list of installed distros.
- [x] **Task 3: Install Ubuntu (AC: #3)**
    - [x] If no Ubuntu instance is found, run `proot-distro install ubuntu`.
    - [x] Handle the output and potential errors from the installation command.
- [x] **Task 4: Verify Ubuntu Accessibility (AC: #5)**
    - [x] Execute a simple, non-interactive command within the Ubuntu proot to confirm it's functional.

## Dev Notes
- **Source Tree**: This functionality will likely be in a new script, `scripts/setup-proot.sh`.
- **Dependency**: This story depends on Story 1.2 (`install-prereqs.sh`) being complete, as `proot-distro` itself is a package handled by `pkg`.
- **User Experience**: The installation of an Ubuntu image can take time and consume significant data/disk space. It is critical that this step is only performed when absolutely necessary (i.e., when a native tool installation fails later on). This story creates the *capability*, but the *decision* to use it will be made in a later story.

### Testing
- **Test File Location**: `tests/test-setup-proot.sh`
- **Test Standards**: Tests should mock or check for the existence of `proot-distro` commands and simulate the output of `proot-distro list`.
- **Requirements**:
    - Test the case where `proot-distro` is not installed.
    - Test the case where `proot-distro` is installed but Ubuntu is not.
    - Test the case where both `proot-distro` and Ubuntu are already installed.
    - Test that the verification step correctly identifies a successful installation.

## Dev Agent Record

### File List
- `scripts/setup-proot.sh`
- `tests/test-setup-proot.sh`

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-10-11 | 1.0 | Initial draft | Sarah (PO) |
| 2025-10-11 | 1.1 | MVP implementation complete | James (dev) |
